#!/bin/bash

# TODO: A bit of duplication is okay - dupe this block with condition based on machine
# TODO: Add condition, don't want to install everything
# Template the packages toml file, and set an "enabled" flag - add condition in here
# Also need to not reinstall packages, especially with brew
{{ range $group, $packages := .packages }}
  echo "Installing packages for {{ $group }}"

  {{ if eq $.is_arm64_linux "true" -}}
    {{ if index $packages "apt" -}}
      sudo apt install -y {{ join " " $packages.apt }}
    {{ end -}}

    {{ if index $packages "snap" -}}
      sudo snap install {{ join " " $packages.snap }}
    {{ end -}}
  {{ else -}}
    {{ if index $packages "brews" -}}
      brew install {{ join " " $packages.brews }}
    {{ end -}}

    {{ if (and (eq $.chezmoi.os "darwin") (index $packages "casks")) -}}
      echo "Installing casks via brew"
      brew install --cask {{ join " " $packages.casks }}
    {{ end -}}
  {{ end -}}
{{ end -}}
